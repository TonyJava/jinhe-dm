<!DOCTYPE html>
<html lang="en">  
<head>
    <meta charset="utf-8">

    <link rel="stylesheet" type="text/css" href="../../dm/common.css">
    <script type="text/javascript" src="../../framework/core.js"></script>
    <script type="text/javascript" src="../../framework/ajax.js"></script>
    <script  src="../../dm/common.js"></script>
    <title>省份互流货量</title>
 
    <script src="../../tools/echarts1.4.1/echarts-plain.js"></script>
    
    <script type="text/javascript">

    window.onload = function() {
        var globalValiable = window.parent.globalValiable;
        if(globalValiable && globalValiable.data) {
            queryParams = globalValiable.queryParams;
            title = queryParams.param1 + queryParams.param1 +  '快运财务收支情况';
            show(globalValiable.data);
            return;
        }
    } 


    function show(originData) {

        var totalIn = 0; 


        var cutval = []; 
        var total = 0; 
        var name = [];     
        
        var income = [];
        var outcome = [];
        var inc  = [];
        var outc = [];


        var totalval = [];
    
     
        for(var i = 0; i < originData.length; i++) {
            var type = originData[i]["type"];
            var valname = originData[i]["valname"];
            var realval = originData[i]["realval"];
            var val = originData[i]["val"];

            name[i] = valname;

            income [i] = '-';
            inc [i] = 0;
            outcome [i] = '-';
            outc[i] = 0;

            if( type == '收入') {
                income[i] = val;
                inc[i] = val;
            }

            if (type == '支出') {
                outcome[i] = val;
                outc [i] =val;
            }             

            totalIn = totalIn + realval;
            
            totalval[i] = totalIn;

            total += realval;            
            
        }

        cutval[0]=0;

        for(var j = 1; j < income.length; j++){
            
            if ((income[j-1] != '-') && (outcome[j-1]== '-') && (outcome [j]=='-')) {
                cutval[j] = cutval[j-1]+ inc[j-1];
            }
            else{
                cutval[j] = cutval[j-1]+ inc[j-1]- outc[j];
            };
           
        }

		var myChart = echarts.init(document.getElementById('main'));
 
        var option = {
            title: {
                text: '阶梯瀑布图'
            },
            tooltip : {
                trigger: 'axis',
                axisPointer : {            // 坐标轴指示器，坐标轴触发有效
                    type : 'shadow'        // 默认为直线，可选为：'line' | 'shadow'
                }
            },
            legend: {
                data:['支出','收入']
            },
            toolbox: {
                show : true,
                feature : {
                    mark : {show: true},
                    dataView : {show: true, readOnly: false},
                    restore : {show: true},
                    saveAsImage : {show: true}
                }
            },
            xAxis : [
                {
                    type : 'category',
                    splitLine: {show:false},
                    data : name
                }
            ],
            yAxis : [
                {
                    type : 'value'
                }
            ],
            series : [
                {
                    name:'总值',
                    type:'bar',
                    stack: '总量',
                    itemStyle:{
                        normal:{
                            borderColor:'rgba(0,0,0,0)',
                            color:'rgba(0,0,0,0)'
                        },
                        emphasis:{
                            borderColor:'rgba(0,0,0,0)',
                            color:'rgba(0,0,0,0)'
                        }
                    },
                    data:cutval
                },
                {
                    name:'收入',
                    type:'bar',
                    stack: '总量',
                    itemStyle : { normal: {label : {show: true, position: 'top'}}},
                    data:income
                },
                {
                    name:'支出',
                    type:'bar',
                    stack: '总量',
                    itemStyle : { normal: {label : {show: true, position: 'bottom'}}},
                    data:outcome
                }
            ]
        };
                    
                    
        myChart.setOption(option);
	}
    </script> 
    
</head>

<body>

    <div id="main" style="height:660px;border:1px solid #ccc;padding:10px;"></div>

</body>
</html>